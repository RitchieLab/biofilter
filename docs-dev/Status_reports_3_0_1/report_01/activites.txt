- Close the 2.4.4 version
- Merged development branch to Main branch
- Change development branch to 3.0.1 version
- Comparacao entre o Schema do Biofilter 2.4.4 e 3.0.0 (nao vi diferencas)

- Create package 3.0.1 

Start version 3.0.2
- TODO
    - Create log file in loki-build
    - Fix arg source problem
    - Improve time
    - Propose to read a read-db from cloud


BUG
O sistema estava comparando o caminho do arquivo ingerido para comparar com os novos dados.
como o caminho era sempre um temporario, o sistema entendia que era versoes diferentes e atualiza nomente
                            n += 1
                            # skip = (
                            #     skip
                            #     and (row[0] in self._filehash)
                            #     and (row[1] == self._filehash[row[0]][1])
                            #     and (row[2] == self._filehash[row[0]][3])
                            # )

                            # Get the file size and MD5 hash directly from _filehash
                            file_size, file_md5 = row[1], row[2]
                            
                            # Check if there is any file in _filehash with the same parameters
                            match_found = any(
                                file_hash_data[1] == file_size and file_hash_data[3] == file_md5
                                for file_hash_data in self._filehash.values()
                            )
                            
                            # Update the state of `skip`
                            skip = skip and match_found

                        skip = skip and (n == len(self._filehash))


BUG:
Hoje com a logica atual nao temos como evitar realizar o download para verificar se o arquivo ja foi processado ou nao. 

para resolver esse problema, foi criada um method addWarning para reportar o problema na tabela e adicionado,
tb foi alterado uma variavel de controle para ser um atributo da classe Update, dessa forma podemos excluir o Source System
com erro e nao realizar o processamento (uma vez que o processamento envolve eliminar todos os dados desse source)
<<update_download_mixin.py>>
    ...
        except Exception as e:
            # No raise exception to continue other sources
            # Log the exception
            self.log_exception(e)

            # Remove the source from the list of sources to avoid run process
            if srcName in self.srcSetsToDownload:
                self.srcSetsToDownload.remove(srcName)

            msn_error = f"Error downloading {srcName} data: {str(e)}"
            self._loki.addWarning(srcObj._sourceID, msn_error)


BUG: O LOADER Oreganno nao estava alinhado com as praticas das classes source e updater, nao 
fazia a composicao do path, nao passava o path como argumento

Adicionado campo na Source para controlar os loardes com sucesso e os com errors
adcionado argumento para manter os arquivos baixados
adicionadas rotinas para rodar somente o download, para manter, e para pular os downloads.

Melhorias:
- [Implementada] nao temos um controle para saber quais sources deram erros e poder reprocessar eles.
- [Implementada] nao temos um caminho para processar arquivos que ja estejam em pasta.
- Utilizar o getDatabaseMemoryUsage para mostrar a menoria da base alocada
- Ver por que a conferencia dos arquivos se foi baixado nao esta sendo acionada
- Implementar conceitos do BW como:
        Source System
        Source Data
        Data Transfer Process (DTP)
        Transformation Rules

Ja rodaram
go
gwas
biogrid
mint
pharmgkb
oreganno
UCSC-ucsc_ecr
chainfiles
dbSNP


com Error ou falltam
entrez
Pfam - Erro no endereco de pagina
reactome



Saída .dot do Pyreverse:

Gere a saída do Pyreverse em formato .dot:
$ pyreverse -o dot -p biofilter_loki .
Edite o Arquivo .dot:

Adicione conexões manuais representando os mixins. No arquivo .dot, você pode adicionar algo como:
"MixinName" -> "ParentClass" [label="Mixin"];
Regenere o Diagrama com Graphviz:

Após editar, gere o diagrama novamente:
$ dot -Tpng classes.dot -o classes.png

Added:
"loki_modules.loki_mixins.db_config_mixin.DbConfigMixin" -> "loki_modules.loki_db.Database" [label="Config"];
"loki_modules.loki_mixins.db_liftover_mixin.DbLiftOverMixin" -> "loki_modules.loki_db.Database" [label="LiftOver"];
"loki_modules.loki_mixins.db_operations_mixin.DbOperationsMixin" -> "loki_modules.loki_db.Database" [label="Operations"];
"loki_modules.loki_mixins.db_query_mixin.DbQueryMixin" -> "loki_modules.loki_db.Database" [label="Operations"];
"loki_modules.loki_mixins.db_schema_mixin.DbSchemaMixin" -> "loki_modules.loki_db.Database" [label="Schema_Operations"];
"loki_modules.loki_mixins.db_schema.DbSchema" -> "loki_modules.loki_db.Database" [label="Schema"];
"loki_modules.loki_mixins.db_version_mixin.DbVersion" -> "loki_modules.loki_db.Database" [label="Version_Control"];

"loki_modules.loki_mixins.updater_database.UpdaterDatabaseMixin" -> "loki_modules.loki_updater.Updater" [label="Update_Database"];
"loki_modules.loki_mixins.updater_download_mixin.UpdaterDownloadMixin" -> "loki_modules.loki_updater.Updater" [label="Download"];
"loki_modules.loki_mixins.updater_liftover_mixin.UpdaterLiftOverMixin" -> "loki_modules.loki_updater.Updater" [label="LiftOver"];
"loki_modules.loki_mixins.updater_operations_mixin.UpdaterOperationsMixin" -> "loki_modules.loki_updater.Updater" [label="Operations"];

"loki_modules.loki_mixins.source_db_operations_mixin.SourceDbOperations" -> "loki_modules.loki_source.Source" [label="Operations"];
"loki_modules.loki_mixins.source_utility_methods_mixin.SourceUtilityMethods" -> "loki_modules.loki_source.Source" [label="Utility"];






Novos inputs:
- Aplicado o multiprocessamento do UCSC-ECr Source System
      utilizado 12 cores em local laptop
      Rodou em 30 minutos (sem considerar os downloads)
      Base de dadps resultante: 477 Mb




                "--knowledge", "/Users/andrerico/Works/Sys/biofilter/data/loki.db",
                "--update",
                "--temp-directory", "/Users/andrerico/Works/Sys/biofilter/downloads",
                "--list-sources", "dbsnp",
                "--keep-download",
                "--skip-download",
                // "--only-download",
                "--force-update"
                // "--update-except", "entrez", "dbsnp", "pfam", "oreganno", "go", "mint", "pharmgkb", "ucsc_ecr", "gwas", "chainfiles", "reactome",
                // "--update-except", "biogrid", "dbsnp", "pfam", "oreganno", "go", "mint", "pharmgkb", "ucsc_ecr", "gwas", "chainfiles", "reactome",
                // "--update-except", "biogrid", "entrez", "pfam", "oreganno", "go", "mint", "pharmgkb", "ucsc_ecr", "gwas", "chainfiles", "reactome",


BUG: no Workflow ha no bloco 2 de pos processamento um liftover caso o hg seja diferente do definido na base. Isso usa a table Chain, talvez teremos que carregar essa tabela primeiro






para segunda
- ver com a Van para analisar os novos caminhos para o Pfam
    ftp.ebi.ac.uk/pub/databases/Pfam/current_release/database_files/pfamA.txt.gz
    ftp.ebi.ac.uk/pub/databases/Pfam/current_release/database_files/pfamA_reg_full_significant.txt.gz
    ftp.ebi.ac.uk/pub/databases/Pfam/current_release/database_files/pfamseq.txt.gz

