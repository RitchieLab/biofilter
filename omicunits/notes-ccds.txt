select group_concat(distinct name) from (select rn2.name from region_name rn join region r on r.region_id=rn.region_id join unit_name_name unn on unn.namespace_id1=3 and unn.name1=rn.name and unn.namespace_id2=4 join region_name rn2 on rn2.namespace_id=4 and rn2.name=unn.name2 join region r2 on r2.region_id=rn2.region_id where rn.namespace_id=3 group by rn2.region_id having not (min(r.chr)=max(r.chr) and min(r2.chr)=max(r2.chr) and min(r.chr)=min(r2.chr) and min(r.posMin)>=min(r2.posMin) and max(r.posMax)<=max(r2.posMax)));

9189,10251,1438,8227,293,6845,28227,3581,6473,647042,10320,438,51284,8623,3563,55344,84859,4267,9502,207063,286530,115286,9369,50614

SELECT rnN.name, rN.chr, rN.posMin, rN.posMax, rnC.name AS nameT, rC.chr, rC.posMin, rC.posMax
FROM region_name AS rnN
JOIN region AS rN
  ON rN.region_id = rnN.region_id
JOIN unit_name_name AS unn
  ON unn.namespace_id2=4
  AND unn.name2=rnN.name
  AND unn.namespace_id1=3
JOIN region_name AS rnC
  ON rnC.namespace_id=3
  AND rnC.name=unn.name1
JOIN region AS rC
  ON rC.region_id = rnC.region_id
WHERE rnN.namespace_id=4 AND rnN.name IN (9189,10251,1438,8227,293,6845,28227,3581,6473,647042,10320,438,51284,8623,3563,55344,84859,4267,9502,207063,286530,115286,9369,50614)
ORDER BY rnN.name, rN.chr, rN.posMin, rN.posMax, rC.chr, rC.posMin, rC.posMax


; 37648 Entrez IDs have 37704 regions
SELECT COUNT(DISTINCT rN.region_id), COUNT(DISTINCT rnN.name), COUNT()
FROM region_name AS rnN
JOIN region AS rN
  ON rN.region_id = rnN.region_id
WHERE rnN.namespace_id=4

; 18538 Entrez IDs with 18561 regions have CCDS IDs
SELECT COUNT(DISTINCT rN.region_id), COUNT(DISTINCT rnN.name), COUNT()
FROM region_name AS rnN
JOIN region AS rN
  ON rN.region_id = rnN.region_id
JOIN unit_name_name AS unn
  ON unn.namespace_id2=4
  AND unn.name2=rnN.name
  AND unn.namespace_id1=3
WHERE rnN.namespace_id=4

; 18526 Entrez IDs with 18549 regions have CCDS regions
SELECT COUNT(DISTINCT rN.region_id), COUNT(DISTINCT rnN.name), COUNT()
FROM region_name AS rnN
JOIN region AS rN
  ON rN.region_id = rnN.region_id
JOIN unit_name_name AS unn
  ON unn.namespace_id2=4
  AND unn.name2=rnN.name
  AND unn.namespace_id1=3
JOIN region_name AS rnC
  ON rnC.namespace_id=3
  AND rnC.name=unn.name1
JOIN region AS rC
  ON rC.region_id = rnC.region_id
WHERE rnN.namespace_id=4

; 18502 Entrez IDs have only 1 region and all matching CCDS regions are fully within it
SELECT COUNT() FROM (
SELECT rnN.name
FROM region_name AS rnN
JOIN region AS rN
  ON rN.region_id = rnN.region_id
JOIN unit_name_name AS unn
  ON unn.namespace_id2=4
  AND unn.name2=rnN.name
  AND unn.namespace_id1=3
JOIN region_name AS rnC
  ON rnC.namespace_id=3
  AND rnC.name=unn.name1
JOIN region AS rC
  ON rC.region_id = rnC.region_id
WHERE rnN.namespace_id=4
GROUP BY rnN.name
HAVING COUNT(DISTINCT rN.region_id)=1
  AND MIN(rC.chr)=MIN(rN.chr)
  AND MAX(rC.chr)=MIN(rN.chr)
  AND MIN(rC.posMin)>=MIN(rN.posMin)
  AND MAX(rC.posMax)<=MAX(rN.posMax)
)

; 24 Entrez IDs have multiple regions, or at least one non-contained CCDS region
SELECT GROUP_CONCAT(DISTINCT name) FROM (
SELECT rnN.name
FROM region_name AS rnN
JOIN region AS rN
  ON rN.region_id = rnN.region_id
JOIN unit_name_name AS unn
  ON unn.namespace_id2=4
  AND unn.name2=rnN.name
  AND unn.namespace_id1=3
JOIN region_name AS rnC
  ON rnC.namespace_id=3
  AND rnC.name=unn.name1
JOIN region AS rC
  ON rC.region_id = rnC.region_id
WHERE rnN.namespace_id=4
GROUP BY rnN.name
HAVING NOT (
  COUNT(DISTINCT rN.region_id)=1
))

; these are them
SELECT COUNT() FROM (
SELECT rnN.name, rN.chr, rN.posMin, rN.posMax, rnC.name, rC.chr, rC.posMin, rC.posMax
FROM region_name AS rnN
JOIN region AS rN
  ON rN.region_id = rnN.region_id
JOIN unit_name_name AS unn
  ON unn.namespace_id2=4
  AND unn.name2=rnN.name
  AND unn.namespace_id1=3
JOIN region_name AS rnC
  ON rnC.namespace_id=3
  AND rnC.name=unn.name1
JOIN region AS rC
  ON rC.region_id = rnC.region_id
WHERE rnN.namespace_id=4
  AND rnN.name IN (10251,10320,115286,1438,207063,28227,286530,293,3563,3581,4267,438,50614,51284,55344,647042,6473,6845,8227,84859,8623,9189,9369,9502)
ORDER BY rnN.name, rN.chr, rN.posMin, rN.posMax, rC.chr, rC.posMin, rC.posMax
)

